# 订单节拍器 - 产品手册

> **Order Metronome** - 外贸订单执行追踪系统
>
> 核心理念：**卡风险，而不是走流程**

---

## 目录

1. [产品概述](#1-产品概述)
2. [核心功能](#2-核心功能)
3. [用户角色与权限](#3-用户角色与权限)
4. [页面功能说明](#4-页面功能说明)
5. [18关卡系统](#5-18关卡系统)
6. [订单生命周期](#6-订单生命周期)
7. [里程碑状态管理](#7-里程碑状态管理)
8. [延期申请流程](#8-延期申请流程)
9. [邮件通知系统](#9-邮件通知系统)
10. [操作指南](#10-操作指南)
11. [常见问题](#11-常见问题)

---

## 1. 产品概述

### 1.1 产品定位

**订单节拍器**是一款专为外贸企业设计的订单执行追踪系统。它通过18个关键控制点（关卡）实时监控订单执行进度，帮助团队及早发现风险、快速响应问题。

### 1.2 核心价值

| 价值点 | 说明 |
|--------|------|
| **风险预警** | 自动识别超期、阻塞的节点，第一时间推送告警 |
| **责任明确** | 每个节点有明确的负责角色和负责人 |
| **进度可视** | 订单状态红黄绿灯一目了然 |
| **数据沉淀** | 完整的操作日志和复盘记录 |

### 1.3 技术架构

- **前端**: Next.js 16 + React 19 + TailwindCSS
- **后端**: Next.js Server Actions + API Routes
- **数据库**: Supabase (PostgreSQL)
- **认证**: Supabase Auth (邮箱认证)

### 1.4 访问限制

- 仅限 `@qimoclothing.com` 邮箱域名登录
- 管理员：alex@qimoclothing.com, su@qimoclothing.com

---

## 2. 核心功能

### 2.1 功能全景图

```
┌─────────────────────────────────────────────────────────────┐
│                      订单节拍器                              │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │  我的工作台  │  │  订单列表   │  │  管理后台   │         │
│  │  /dashboard │  │  /orders    │  │  /admin     │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│         │                │                │                 │
│         ▼                ▼                ▼                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐         │
│  │ • 超期节点  │  │ • 订单创建  │  │ • 风险订单  │         │
│  │ • 今日到期  │  │ • 订单详情  │  │ • 超期节点  │         │
│  │ • 已阻塞    │  │ • 里程碑    │  │ • 阻塞节点  │         │
│  │ • 待复盘    │  │ • 延期申请  │  │ • 瓶颈分析  │         │
│  └─────────────┘  └─────────────┘  └─────────────┘         │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    CEO 控制台                        │   │
│  │  • 今日必须处理    • 延期审批    • 角色瓶颈分析      │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 功能清单

| 模块 | 功能 | 说明 |
|------|------|------|
| **订单管理** | 新建订单 | 4步向导创建订单，自动生成18个里程碑 |
| | 订单详情 | 查看订单全貌，管理里程碑 |
| | 订单复盘 | 完成后填写复盘记录 |
| **里程碑管理** | 状态更新 | 标记完成、阻塞 |
| | 延期申请 | 申请延期并提供证据 |
| | 负责人分配 | 指定具体负责人 |
| **风险监控** | 超期预警 | 自动识别超期节点 |
| | 阻塞追踪 | 追踪卡住的节点 |
| | 红黄绿灯 | 订单状态可视化 |
| **通知提醒** | 邮件提醒 | 到期前7天、3天、当天提醒 |
| | 手动催办 | 管理员一键催办 |
| **数据分析** | 瓶颈分析 | 按角色统计问题分布 |
| | 复盘沉淀 | 记录经验教训 |

---

## 3. 用户角色与权限

### 3.1 系统角色

| 角色 | 英文 | 职责 |
|------|------|------|
| 业务 | sales | 客户沟通、PO确认、样品跟进 |
| 财务 | finance | 预算审批、付款追踪 |
| 采购 | procurement | 原料采购、供应商管理 |
| 生产 | production | 生产排期、大货生产 |
| 品控 | qc | 质量检验、QC验货 |
| 物流 | logistics | 订舱、出运安排 |
| 管理员 | admin | 系统管理、审批权限 |

### 3.2 权限矩阵

| 操作 | 业务 | 财务 | 采购 | 生产 | 品控 | 物流 | 管理员 |
|------|:----:|:----:|:----:|:----:|:----:|:----:|:------:|
| 创建订单 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看自己订单 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 查看所有订单 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 更新里程碑状态 | 仅负责的 | 仅负责的 | 仅负责的 | 仅负责的 | 仅负责的 | 仅负责的 | ✅ |
| 申请延期 | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ | ✅ |
| 审批延期 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 发送催办 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 分配负责人 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 访问管理后台 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |
| 访问CEO控制台 | ❌ | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

---

## 4. 页面功能说明

### 4.1 我的工作台 (`/dashboard`)

**用途**: 日常工作入口，快速查看需要处理的事项

**四大统计卡片**:

| 卡片 | 颜色 | 含义 |
|------|------|------|
| 已超期 | 🔴 红色 | 到期日已过但未完成的节点 |
| 今日到期 | 🔵 蓝色 | 今天截止的节点 |
| 已阻塞 | 🟠 橙色 | 被标记为"卡住"的节点 |
| 待复盘 | 🟣 紫色 | 已完成但未填写复盘的订单 |

**操作入口**:
- 点击卡片下方列表可直达对应订单/节点
- "去复盘"按钮直达复盘页面
- "解除阻塞"按钮快速解除卡住状态

### 4.2 订单列表 (`/orders`)

**用途**: 管理所有订单

**表格字段**:

| 字段 | 说明 |
|------|------|
| 订单号 | 系统自动生成，不可修改 |
| 客户 | 客户名称 |
| 贸易条款 | FOB 或 DDP |
| ETD/入仓日 | FOB显示ETD，DDP显示入仓日 |
| 类型 | 样品单 或 批量单 |
| 状态 | 🟢绿/🟡黄/🔴红 |

**状态说明**:
- 🟢 **正常**: 无超期、无阻塞
- 🟡 **注意**: 有节点即将到期（≤48小时）
- 🔴 **风险**: 有超期或阻塞节点

### 4.3 新建订单向导 (`/orders/new`)

**4步创建流程**:

```
步骤1: 订单信息
    ↓
步骤2: 确认里程碑
    ↓
步骤3: 执行备注
    ↓
步骤4: 完成
```

**步骤1 - 订单信息**:
- 订单号：系统自动生成（页面加载时）
- 客户名称：必填
- 贸易条款：FOB / DDP
- ETD（FOB必填）/ 入仓日（DDP必填）
- 订单类型：样品单 / 批量单
- 包装类型：标准包装 / 定制包装

**步骤2 - 确认里程碑**:
- 系统根据订单信息自动生成18个里程碑
- 显示每个里程碑的到期日
- 可确认或返回修改

**步骤3 - 执行备注**（可选）:
- 填写执行策略或注意事项

**步骤4 - 完成**:
- 订单创建成功
- 可前往订单详情或返回列表

### 4.4 订单详情 (`/orders/[id]`)

**页面结构**:

```
┌─────────────────────────────────────────────────────────────┐
│  订单头部: 订单号、客户、贸易条款、ETD/入仓日               │
├─────────────────────────────────────────────────────────────┤
│  生命周期状态条: 草稿 → 已生效 → 执行中 → 已完成 → 已复盘   │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  里程碑时间线                                                │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ ● PO确认        [已完成]  2024-01-15                │   │
│  │ ● 财务审批      [进行中]  2024-01-17   ← 当前节点   │   │
│  │ ○ 采购下单      [未开始]  2024-01-18                │   │
│  │ ○ ...                                               │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  当前节点操作区:                                            │
│  [✅ 完成] [❌ 阻塞] [📧 提醒负责人] [申请延期]             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

**里程碑卡片信息**:
- 名称
- 状态徽章（未开始/进行中/卡住/已完成）
- 关键节点标记
- 到期日（超期显示红色）
- 负责角色
- 负责人（如已分配）

**操作按钮**:
- **完成**: 标记当前节点为已完成
- **阻塞**: 标记为卡住并填写原因
- **提醒负责人**: 发送催办邮件（管理员）
- **申请延期**: 提交延期申请

### 4.5 管理后台 (`/admin`)

**访问权限**: 仅管理员

**功能模块**:

1. **今日必须处理**
   - 阻塞节点
   - 24小时内到期的进行中节点
   - 所有超期节点

2. **统计概览**
   - 风险订单数
   - 超期节点数
   - 阻塞节点数

3. **风险订单列表**
   - 显示红/黄状态订单
   - 快速跳转详情

4. **超期节点列表**
   - 按到期日排序
   - 显示负责角色

5. **角色瓶颈分析**
   - 按角色统计问题数量
   - 显示占比

### 4.6 CEO 控制台 (`/admin/ceo`)

**访问权限**: 仅管理员

**功能模块**:

1. **数据概览**（4卡片）
   - 已超期
   - 已阻塞
   - 待审批（延期申请）
   - 总瓶颈

2. **超期节点**
   - 进行中但已超期的节点

3. **阻塞节点**
   - 状态为"卡住"的节点

4. **待审批延期申请**
   - 显示申请详情
   - 审批/驳回操作

5. **角色瓶颈分析**
   - 按角色统计

6. **用户瓶颈分析**
   - 按负责人统计

### 4.7 订单复盘 (`/orders/[id]/retrospective`)

**触发条件**: 订单完成或取消后

**填写内容**:

| 字段 | 说明 |
|------|------|
| 是否按时交付 | 是/否 |
| 主要延迟原因 | 客户/供应商/内部/物流/其他 |
| 阻塞节点数 | 自动统计 |
| 延期申请数 | 自动统计 |
| 关键问题 | 描述主要问题 |
| 根本原因 | 分析根因 |
| 做得好的地方 | 总结经验 |
| 改进措施 | 列出改进计划 |

---

## 5. 18关卡系统

### 5.1 关卡总览

系统预设18个关键控制点，覆盖订单全生命周期：

```
阶段A: 订单启动 (7个关卡)
├── 1. PO确认
├── 2. 财务审批
├── 3. 订单资料完整
├── 4. 原料采购单
├── 5. 财务采购审批
├── 6. 采购下单
└── 7. 原料检验

阶段B: 产前样确认 (4个关卡)
├── 8. 产前样完成
├── 9. 产前样寄出
├── 10. 产前样确认
└── 11. 大货启动

阶段C: 生产到出货 (5个关卡)
├── 12. 中期验货
├── 13. 尾期验货
├── 14. 包装材料到位
├── 15. QC预约
└── 16. QC验货完成

阶段D: 出运与结算 (2个关卡)
├── 17. 订舱完成
└── 18. 出运完成
```

### 5.2 关卡详细说明

| # | 关卡名称 | 负责角色 | 关键节点 | 到期计算 |
|---|----------|----------|:--------:|----------|
| 1 | PO确认 | 业务 | ✅ | T0（创建日） |
| 2 | 财务审批 | 财务 | | T0+2天 |
| 3 | 订单资料完整 | 业务 | | T0+3天 |
| 4 | 原料采购单 | 业务 | | T0+2天 |
| 5 | 财务采购审批 | 财务 | | T0+2天 |
| 6 | 采购下单 | 采购 | | T0 |
| 7 | 原料检验 | 品控 | | ETD-28~30天 |
| 8 | 产前样完成 | 品控 | | ETD-25~27天 |
| 9 | 产前样寄出 | 生产 | | ETD-24天 |
| 10 | 产前样确认 | 业务 | ✅ | ETD-20天 |
| 11 | 大货启动 | 生产 | ✅ | ETD-18天 |
| 12 | 中期验货 | 品控 | | ETD-12天 |
| 13 | 尾期验货 | 品控 | | ETD-7天 |
| 14 | 包装材料到位 | 采购 | | ETD-10天 |
| 15 | QC预约 | 品控 | | ETD-5天 |
| 16 | QC验货完成 | 品控 | ✅ | ETD-3天 |
| 17 | 订舱完成 | 物流 | | FOB: ETD-7天 / DDP: ETD-21天 |
| 18 | 出运完成 | 物流 | ✅ | ETD（锚点日） |

### 5.3 到期日计算规则

**锚点日期**:
- FOB订单：以 ETD（预计开船日）为锚点
- DDP订单：以 入仓日 为锚点

**计算逻辑**:
- 内部节点（1-6）：相对于订单创建日（T0）
- 外部节点（7-18）：相对于锚点日倒推

**周末调整**:
- 如果到期日落在周六/周日，自动调整到前一个周五

**示例**:
```
订单创建日: 2024-01-10
ETD: 2024-02-28

PO确认到期日 = 2024-01-10 (T0+0)
财务审批到期日 = 2024-01-12 (T0+2)
大货启动到期日 = 2024-02-10 (ETD-18天)
出运完成到期日 = 2024-02-28 (ETD)
```

---

## 6. 订单生命周期

### 6.1 状态流转图

```
┌────────┐
│  草稿  │ ← 新建订单后的初始状态
└────┬───┘
     │ [激活订单]
     ▼
┌────────┐
│ 已生效 │ ← 订单确认，准备执行
└────┬───┘
     │ [开始执行]
     ▼
┌────────┐
│ 执行中 │ ← 里程碑推进中
└────┬───┘
     │
     ├─────[所有节点完成]─────┐
     │                        ▼
     │                   ┌────────┐
     │                   │ 已完成 │
     │                   └────┬───┘
     │                        │
     ├─────[申请取消]─────┐   │
     │                    ▼   │
     │               ┌────────┴─┐
     │               │  已取消  │
     │               └────┬─────┘
     │                    │
     └────────────────────┴─────┐
                                ▼
                           ┌────────┐
                           │ 待复盘 │ ← 需要填写复盘
                           └────┬───┘
                                │ [提交复盘]
                                ▼
                           ┌────────┐
                           │ 已复盘 │ ← 订单完全关闭
                           └────────┘
```

### 6.2 状态说明

| 状态 | 说明 | 可执行操作 |
|------|------|------------|
| 草稿 | 订单刚创建，未正式生效 | 激活、编辑、删除 |
| 已生效 | 订单确认，等待执行 | 开始执行、取消 |
| 执行中 | 里程碑推进中 | 更新里程碑、申请延期、申请取消 |
| 已完成 | 所有里程碑完成 | 进入待复盘 |
| 已取消 | 订单取消 | 进入待复盘 |
| 待复盘 | 等待填写复盘记录 | 提交复盘 |
| 已复盘 | 订单完全关闭 | 只读查看 |

---

## 7. 里程碑状态管理

### 7.1 里程碑状态

| 状态 | 显示 | 说明 |
|------|------|------|
| 未开始 | ⚪ 灰色 | 尚未开始处理 |
| 进行中 | 🔵 蓝色 | 正在处理中 |
| 卡住 | 🟠 橙色 | 遇到问题被阻塞 |
| 已完成 | 🟢 绿色 | 已经完成 |

### 7.2 状态转换规则

```
        ┌─────────────────────────────┐
        │                             │
        ▼                             │
   ┌─────────┐                        │
   │ 未开始  │                        │
   └────┬────┘                        │
        │                             │
        ├──────[开始处理]──────┐      │
        │                      ▼      │
        │                 ┌─────────┐ │
        │                 │ 进行中  │ │
        │                 └────┬────┘ │
        │                      │      │
        │     ┌────[阻塞]──────┤      │
        │     ▼                │      │
        │ ┌─────────┐          │      │
        │ │  卡住   │──[解除]──┘      │
        │ └─────────┘                 │
        │                             │
        │                             │
        └────────[完成]───────────────┘
                   │
                   ▼
              ┌─────────┐
              │ 已完成  │ (终态，不可逆)
              └─────────┘
```

### 7.3 阻塞处理

**标记阻塞**:
1. 在进行中的里程碑上点击"阻塞"
2. 填写阻塞原因（必填）
3. 状态变为"卡住"
4. 出现在工作台和管理后台的阻塞列表

**解除阻塞**:
1. 管理员或负责人点击"解除阻塞"
2. 状态恢复为"进行中"
3. 记录解除日志

---

## 8. 延期申请流程

### 8.1 申请流程

```
┌──────────────────────────────────────────────────────────────┐
│                      延期申请流程                            │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 提交申请                                                 │
│     ├── 选择原因类型                                         │
│     ├── 填写详细原因                                         │
│     ├── 选择延期类型（修改锚点/仅修改节点）                   │
│     ├── 填写新日期                                           │
│     └── 上传客户确认证据（如需要）                           │
│                    │                                         │
│                    ▼                                         │
│  2. 等待审批      [待审批]                                   │
│                    │                                         │
│         ┌─────────┴─────────┐                               │
│         ▼                   ▼                               │
│  3a. 审批通过          3b. 审批驳回                          │
│      [已批准]               [已驳回]                         │
│         │                   │                               │
│         ▼                   ▼                               │
│  更新里程碑日期         保持原日期                           │
│  （级联更新依赖节点）                                        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 8.2 原因类型

| 类型 | 说明 |
|------|------|
| 客户确认 | 等待客户确认或回复 |
| 供应商延迟 | 供应商交货延迟 |
| 内部延迟 | 公司内部原因 |
| 物流原因 | 运输、报关等问题 |
| 不可抗力 | 自然灾害、政策变化等 |
| 其他 | 其他原因 |

### 8.3 延期类型

| 类型 | 说明 | 影响 |
|------|------|------|
| 修改锚点日期 | 修改ETD或入仓日 | 所有依赖此锚点的节点日期都会重新计算 |
| 仅修改节点日期 | 只修改当前节点到期日 | 只影响当前节点 |

### 8.4 客户确认证据

- 如果延期需要客户确认，需上传证据链接
- 证据可以是邮件截图、聊天记录等
- 审批时会显示证据链接供查看

---

## 9. 邮件通知系统

### 9.1 自动提醒

| 时间点 | 邮件标题 | 说明 |
|--------|----------|------|
| 到期前7天 | 早期预警 | 提前规划 |
| 到期前3天 | 需要关注 | 加紧处理 |
| 到期当天 | 今日到期 | 最后提醒 |
| 超期后 | 已超期警告 | 紧急处理 |

### 9.2 手动催办

**触发方式**: 管理员在里程碑详情页点击"提醒负责人"

**频率限制**: 同一里程碑每小时最多催办1次

**邮件内容**:
- 订单号、客户名称
- 里程碑名称
- 当前状态
- 到期日
- 操作链接

### 9.3 邮件接收人

| 场景 | 接收人 |
|------|--------|
| 里程碑提醒 | 里程碑负责人（如未分配则为订单创建者） |
| 催办邮件 | 里程碑负责人 + 抄送管理员 |
| 延期审批结果 | 申请人 |

---

## 10. 操作指南

### 10.1 日常工作流程（员工）

**每日开始**:
1. 登录系统，进入"我的工作台"
2. 查看四大卡片数据
3. 优先处理：超期 > 今日到期 > 阻塞

**处理里程碑**:
1. 点击里程碑进入详情
2. 如果完成 → 点击"完成"
3. 如果遇阻 → 点击"阻塞"并填写原因
4. 如果需延期 → 提交延期申请

**每日结束**:
1. 确认当日到期节点已处理
2. 检查明日到期节点准备情况

### 10.2 日常工作流程（管理员）

**每日检查**:
1. 进入"管理后台"或"CEO控制台"
2. 处理待审批的延期申请
3. 查看"今日必须处理"清单
4. 对超期节点发送催办
5. 分析瓶颈，协调资源

**审批延期**:
1. 查看延期原因和证据
2. 评估影响
3. 批准或驳回并填写备注

### 10.3 创建订单流程

1. 点击"新建订单"
2. **步骤1**: 填写订单信息
   - 客户名称
   - 贸易条款（FOB/DDP）
   - ETD或入仓日
   - 订单类型
3. **步骤2**: 确认生成的里程碑计划
4. **步骤3**: 填写执行备注（可选）
5. **步骤4**: 完成创建

### 10.4 订单复盘流程

**触发条件**: 订单完成或取消后

**操作步骤**:
1. 在工作台看到"待复盘"提示
2. 点击"去复盘"
3. 填写复盘表单：
   - 是否按时交付
   - 主要延迟原因
   - 关键问题
   - 根本原因
   - 做得好的地方
   - 改进措施
4. 提交复盘

---

## 11. 常见问题

### Q1: 订单号可以自己输入吗？

**不可以**。订单号由系统自动生成，保证唯一性和不可篡改。

### Q2: 为什么我看不到管理后台？

管理后台仅对管理员开放。如需管理员权限，请联系系统管理员。

### Q3: 延期申请被驳回后怎么办？

可以重新提交延期申请，补充更多说明或证据。也可以联系管理员沟通。

### Q4: 里程碑到期日可以手动修改吗？

不能直接修改。如需调整，请通过"申请延期"功能提交申请，经审批后系统会自动更新。

### Q5: 催办邮件发不出去？

催办有频率限制，同一里程碑每小时最多催办1次。请稍后再试。

### Q6: 订单完成后为什么还要复盘？

复盘是沉淀经验、持续改进的重要环节。通过复盘可以：
- 总结成功经验
- 分析问题根因
- 制定改进措施
- 为后续订单提供参考

### Q7: 我的邮箱不是 @qimoclothing.com 能登录吗？

**不能**。系统仅限 @qimoclothing.com 域名邮箱登录。

### Q8: 阻塞原因填错了怎么办？

解除阻塞后重新标记阻塞，填写正确的原因。

### Q9: 如何查看历史操作记录？

在订单详情页的里程碑展开区域，可以查看"操作日志"，显示所有状态变更记录。

### Q10: 周末到期的节点如何处理？

系统会自动将周末到期的节点调整到前一个周五，避免周末无人处理。

---

## 附录

### A. 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Ctrl/Cmd + K` | 快速搜索订单 |

### B. 浏览器支持

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### C. 联系支持

- 技术问题：联系系统管理员
- 功能建议：提交 GitHub Issue

---

**版本**: v1.0
**更新日期**: 2024年1月
**维护团队**: Qimo Technology
